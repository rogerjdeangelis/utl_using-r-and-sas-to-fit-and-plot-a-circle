%let pgm=utl_using-r-and-sas-to-fit-and-plot-a-circle;

Using r and sas to fit and plot a circle

%stop_submission;

related repos

uses library r library conicfit
https://github.com/rogerjdeangelis/utl-AI-computer-vision-fitting-a-circle-to-a-scatter-plot-of-points-wps-r

https://github.com/rogerjdeangelis/utl-spp-univariate-spatial-point-patterns-observed-within-and-outside-a-circle

/*                   _         _   _     _
  ___ _ __ ___  __ _| |_ ___  | |_| |__ (_)___
 / __| `__/ _ \/ _` | __/ _ \ | __| `_ \| / __|
| (__| | |  __/ (_| | ||  __/ | |_| | | | \__ \
 \___|_|  \___|\__,_|\__\___|  \__|_| |_|_|___/

*/

/**************************************************************************************************************************/
/*                                                                                                                        */
/*                 QUITE A BIT OF MANUAL EDITIONG                                                                         */
/*                                                                                                                        */
/*                                X                                                                                       */
/*        1.5     -1     -0.5    0.00    0.5       1     1.5                                                              */
/*        -+-------+-------+-------+-------+-------+-------+--                                                            */
/*        |                                                  |                                                            */
/*        | FITTING OBSERVED X, Y VALUES TO A CIRCLE         |                                                            */
/*        |                                                  |                                                            */
/*        |   2      2     2                                 |                                                            */
/*        |  X   +  Y   = R      R         = 1.16            |                                                            */
/*        |                      Center Y  = -0.09           |                                                            */
/*        |                      Center X  = 0.09            |                                                            */
/*        |                                                  |                                                            */
/*     Y  |--------------------------------------------------|  Y                                                         */
/*        |                                                  |                                                            */
/*    1.5 +                                                  +  1.5                                                       */
/*        |                    ............+ (0.5,1.1)       |                                                            */
/*        |               ......    |    ......              |                                                            */
/*        |             ...         |          ...           |                                                            */
/*    1.0 + (-0.3,0.8) +.           |            ...         +  1.0                                                       */
/*        |          ..             |              ..        |                                                            */
/*        |         ..       radius = 1.15          ...      |                                                            */
/*        |        ..               |                 .      |                                                            */
/*    0.5 +       ..                |       (1.2,0.3) .+     +  0.5                                                       */
/*        |      ...                |                  ..  ) |                                                            */
/*        |      +.(-1.1,0.1)       |                  ..    |                                                            */
/*        |      .                  | Center Point      .    |                                                            */
/*    0.0 +     -.------------------+-------------------.    +  0.0                                                       */
/*        |      ..                 | (0.09,-0.09)     ..    |                                                            */
/*        |       .                 |                  .     |                                                            */
/*        |       ..                |                 ..     |                                                            */
/*   -0.5 +        ..               |                ..      + -0.5                                                       */
/*        |         ..       radius = 1.15          ..       |                                                            */
/*        |                         |              ..        |                                                            */
/*        | (-0.8,-0.9)+            |            ..          |                                                            */
/*   -1.0 +             ....        |         .+.(0.7,-1)    + -1.0                                                       */
/*        |                ......   |    ......              |                                                            */
/*        |                     ....| ....                   |                                                            */
/*        |                                                  |                                                            */
/*   -1.5 +                                                  + -1.5                                                       */
/*        |                                                  |                                                            */
/*        -+-------+-------+-------+-------+-------+-------+--                                                            */
/*        1.5     -1     -0.5    0.00    0.5       1     1.5                                                              */
/*                                                                                                                        */
/*                                 X                                                                                      */
/*                                                                                                                        */
/**************************************************************************************************************************/


/*                   _
(_)_ __  _ __  _   _| |_
| | `_ \| `_ \| | | | __|
| | | | | |_) | |_| | |_
|_|_| |_| .__/ \__,_|\__|
        |_|
*/

libname sd1 "d:/sd1";
options validvarname=upcase;
data sd1.have;
  input xp  yp;
cards4;
 1.2  0.3
 0.5  1.1
-0.3  0.8
-1.1  0.1
-0.8 -0.9
 0.7 -1.0
;;;;
run;quit;

/**************************************************************************************************************************/
/*                                                                                                                        */
/* Obs     XP      YP                                                                                                     */
/*                                                                                                                        */
/*  1      1.2     0.3                                                                                                    */
/*  2      0.5     1.1                                                                                                    */
/*  3     -0.3     0.8                                                                                                    */
/*  4     -1.1     0.1                                                                                                    */
/*  5     -0.8    -0.9                                                                                                    */
/*  6      0.7    -1.0                                                                                                    */
/*                                                                                                                        */
/**************************************************************************************************************************/

options ls=64 ps=30;
proc plot data=sd1.have(rename=yp=y12345678901234567890);
 plot  y12345678901234567890*xp="+"  /box vaxis=-1.5 to 1.5 by .5;
run;quit;

/**************************************************************************************************************************/
/*                                                                                                                        */
/*    Y  --+--------+--------+--------+--------+---                                                                       */
/*   1.5 +                                        +                                                                       */
/*       |                                        |                                                                       */
/*       |                        +               |                                                                       */
/*   1.0 +                                        +                                                                       */
/*       |                +                       |                                                                       */
/*       |                                        |                                                                       */
/*   0.5 +                                        +                                                                       */
/*       |                              +         |                                                                       */
/*       |         +                              |                                                                       */
/*   0.0 +                                        +                                                                       */
/*       |                                        |                                                                       */
/*       |                                        |                                                                       */
/*  -0.5 +                                        +                                                                       */
/*       |                                        |                                                                       */
/*       |            +                           |                                                                       */
/*  -1.0 +                         +              +                                                                       */
/*       |                                        |                                                                       */
/*       |                                        |                                                                       */
/*  -1.5 +                                        +                                                                       */
/*       --+--------+--------+--------+--------+---                                                                       */
/*        -2       -1        0        1        2                                                                          */
/*                                                                                                                        */
/*                           XP                                                                                           */
/*                                                                                                                        */
/**************************************************************************************************************************/

/*
 _ __  _ __ ___   ___ ___  ___ ___
| `_ \| `__/ _ \ / __/ _ \/ __/ __|
| |_) | | | (_) | (_|  __/\__ \__ \
| .__/|_|  \___/ \___\___||___/___/
|_|
*/

options ls=255 ps-65;
%utl_rbeginx;
parmcards4;
library(pracma)
library(haven);
# Example data points
have=read_sas("d:/sd1/have.sas7bdat")
# Fit circle
result <- circlefit(have$XP, have$YP)
# The result contains x and y coordinates of the center, and the radius
center_x <- result[1]
center_y <- result[2]
radius <- result[3]
print(result)
chr=print(result)
writeClipboard(paste(as.character(center_x),as.character(center_y),as.character(radius)))
;;;;
%utl_rendx(return=x_y_radius);

%put &=x_y_radius;

/**************************************************************************************************************************/
/*                                                                                                                        */
/*  Macro ut_rendxsas/r script outputs to the clipboard and sas loads the clipboard into a macro variable                 */
/*                                                                                                                        */
/*  %put &=x_y_radius;                                                                                                    */
/*                                                                                                                        */
/*  X_Y_RADIUS=0.0879882942402339 -0.0869267946614642 1.15514323522768                                                    */
/*                                                                                                                        */
/**************************************************************************************************************************/



data circle (drop=center: radius);;
  center_x= %scan(&x_y_radius,1,%str( ));
  center_y= %scan(&x_y_radius,2,%str( ));
  radius  = %scan(&x_y_radius,3,%str( ));
  do x = -1.2 to +1.4 by .01;
    do y = -1.3 to +1.25 by .01;
      if  round(abs((x-center_x)**2 + (y-center_y)**2 - radius**2),.01) = .01  then output;
    end;
  end;
run;quit;

/**************************************************************************************************************************/
/*                                                                                                                        */
/* Up to 40 obs from last table WORK.CIRCLE total obs=627                                                                 */
/*                                                                                                                        */
/* Obs      X        Y                                                                                                    */
/*                                                                                                                        */
/*   1    -1.07    -0.17                                                                                                  */
/*   2    -1.07    -0.16                                                                                                  */
/*   3    -1.07    -0.15                                                                                                  */
/*   4    -1.07    -0.14                                                                                                  */
/*   5    -1.07    -0.13                                                                                                  */
/* ...                                                                                                                    */
/* 624     1.24     0.03                                                                                                  */
/* 625     1.24     0.04                                                                                                  */
/* 626     1.24     0.05                                                                                                  */
/* 627     1.24     0.06                                                                                                  */
/*                                                                                                                        */
/**************************************************************************************************************************/

data mrg ;
  length xy $32;
  merge circle(in=c) sd1.have;
  if c;
  xy=cats('(',xp,',',yp,')');
  output;
  if _n_=1 then do ;      * center point;
    /* a little bit og hardcoding */
    yp=0.09;
    xp= -0.09;
    xy=cats('(',.09,',',.09,')');
    output;
  end;
run;quit;

/**************************************************************************************************************************/
/*                                                                                                                        */
/*  Up to 40 obs from MRG total obs=628                                                                                   */
/*                                                                                                                        */
/*  Obs    XY               X        Y        XP       YP                                                                 */
/*                                                                                                                        */
/*    1    (1.2,0.3)      -1.07    -0.17     1.20     0.30                                                                */
/*    2    (0.09,0.09)    -1.07    -0.17    -0.09     0.09                                                                */
/*    3    (0.5,1.1)      -1.07    -0.16     0.50     1.10                                                                */
/*    4    (-0.3,0.8)     -1.07    -0.15    -0.30     0.80                                                                */
/*    5    (-1.1,0.1)     -1.07    -0.14    -1.10     0.10                                                                */
/*    6    (-0.8,-0.9)    -1.07    -0.13    -0.80    -0.90                                                                */
/*    7    (0.7,-1)       -1.07    -0.12     0.70    -1.00  adjust center                                                 */
/*    8    (.,.)          -1.07    -0.11      .        .                                                                  */
/*    9    (.,.)          -1.07    -0.10      .        .                                                                  */
/*   10    (.,.)          -1.07    -0.09      .        .                                                                  */
/*                                                                                                                        */
/*  625    (.,.)            .24     0.03      .        .                                                                  */
/*  626    (.,.)           1.24     0.04      .        .                                                                  */
/*  627    (.,.)           1.24     0.05      .        .                                                                  */
/*  628    (.,.)           1.24     0.06      .        .                                                                  */
/*                                                                                                                        */
/**************************************************************************************************************************/


options ls=64 ps=39;
proc plot data=mrg;
 plot  yp*xp="+" $ xy y*x='.' /box overlay
   href=0.09 vref=-0.09;
run;quit;

/**************************************************************************************************************************/
/*                                                                                                                        */
/*                 QUITE A BIT OF MANUAL EDITIONG                                                                         */
/*                                                                                                                        */
/*                                X                                                                                       */
/*        1.5     -1     -0.5    0.00    0.5       1     1.5                                                              */
/*        -+-------+-------+-------+-------+-------+-------+--                                                            */
/*        |                                                  |                                                            */
/*        | FITTING OBSERVED X, Y VALUES TO A CIRCLE         |                                                            */
/*        |                                                  |                                                            */
/*        |   2      2     2                                 |                                                            */
/*        |  X   +  Y   = R      R         = 1.16            |                                                            */
/*        |                      Center Y  = -0.09           |                                                            */
/*        |                      Center X  = 0.09            |                                                            */
/*        |                                                  |                                                            */
/*     Y  |--------------------------------------------------|  Y                                                         */
/*        |                                                  |                                                            */
/*    1.5 +                                                  +  1.5                                                       */
/*        |                    ............+ (0.5,1.1)       |                                                            */
/*        |               ......    |    ......              |                                                            */
/*        |             ...         |          ...           |                                                            */
/*    1.0 + (-0.3,0.8) +.           |            ...         +  1.0                                                       */
/*        |          ..             |              ..        |                                                            */
/*        |         ..       radius = 1.15          ...      |                                                            */
/*        |        ..               |                 .      |                                                            */
/*    0.5 +       ..                |       (1.2,0.3) .+     +  0.5                                                       */
/*        |      ...                |                  ..  ) |                                                            */
/*        |      +.(-1.1,0.1)       |                  ..    |                                                            */
/*        |      .                  | Center Point      .    |                                                            */
/*    0.0 +     -.------------------+-------------------.    +  0.0                                                       */
/*        |      ..                 | (0.09,-0.09)     ..    |                                                            */
/*        |       .                 |                  .     |                                                            */
/*        |       ..                |                 ..     |                                                            */
/*   -0.5 +        ..               |                ..      + -0.5                                                       */
/*        |         ..       radius = 1.15          ..       |                                                            */
/*        |                         |              ..        |                                                            */
/*        | (-0.8,-0.9)+            |            ..          |                                                            */
/*   -1.0 +             ....        |         .+.(0.7,-1)    + -1.0                                                       */
/*        |                ......   |    ......              |                                                            */
/*        |                     ....| ....                   |                                                            */
/*        |                                                  |                                                            */
/*   -1.5 +                                                  + -1.5                                                       */
/*        |                                                  |                                                            */
/*        -+-------+-------+-------+-------+-------+-------+--                                                            */
/*        1.5     -1     -0.5    0.00    0.5       1     1.5                                                              */
/*                                                                                                                        */
/*                                 X                                                                                      */
/*                                                                                                                        */
/**************************************************************************************************************************/

/*              _
  ___ _ __   __| |
 / _ \ `_ \ / _` |
|  __/ | | | (_| |
 \___|_| |_|\__,_|

*/
